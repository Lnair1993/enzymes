#!/bin/bash
echo "Starting auto segmentation in "$1
cd ..
CURR_PCL=0
TOT_N_PCLS=0
for P in `ls -vd $1*.ply`;
do 	 
	TOT_N_PCLS=$((TOT_N_PCLS+1))
done
for P in `ls -vd $1*.ply`;
do 	 
	CURR_PCL=$((CURR_PCL+1))
	NAME_LENGTH=`expr ${#P} - 12`
	P_NAME=`expr substr $P 22 $NAME_LENGTH`
	TYPELESS_FILEPATH_SIZE=`expr ${#P} - 4`
	PCD_TYPE='pcd'
	TYPELESS_FILEPATH=`expr substr $P 1 $TYPELESS_FILEPATH_SIZE`
	PCD_FILEPATH=$TYPELESS_FILEPATH'.pcd'
	PLY_FILEPATH=$TYPELESS_FILEPATH'.ply'
	~/pcl/release/bin/pcl_ply2pcd $PLY_FILEPATH $PCD_FILEPATH $TYPELESS_FILEPATH
	~/pcl/release/bin/pcl_example_cpc_segmentation $PCD_FILEPATH -cut 1,10 -loop $CURR_PCL,$TOT_N_PCLS -o $2 $TYPELESS_FILEPATH -write
done
echo "Done with autosegmentation in "$1

