function [ ptools, ptools_maps, Ps, pcl_filenames, pcl_filenames_with_errors ] = GeneratePointCloudsForSimulation( root_folder, simulation_rootfolder, task, extracted_ptools_filename )
    GAZEBO_PATH = '~/.gazebo/gazebo_models/';   
    task_ = task;
    if exist('extracted_ptools_filename','var')
        load([root_folder extracted_ptools_filename]);
    else
        [ ptools, ptools_maps, Ps, pcl_filenames ] = ExtractPToolsFromFolder( root_folder, task );
    end
    task = task_;
    tot_toc = 0;    
    pcl_filenames_with_errors = {};
    n_iter = numel(pcl_filenames);
    parfor i=1:n_iter
        tic
        try
            simulation_folder = [simulation_rootfolder GetPCLShortName(pcl_filenames{i}) '/'];
            %GeneratePToolsForSimulation( simulation_folder, ptools{i}, task, Ps{i}, ptools_maps{i} );
            GeneratePCLSWithPToolsForSimulation( simulation_folder, ptools{i}, task, Ps{i}, ptools_maps{i} );
            %tot_toc = DisplayEstimatedTimeOfLoop(tot_toc+toc,i,n_iter,'Genearting pcls for simulation: ');
        %catch E
            %warning([E.message ': ' pcl_filenames{i}]);
            %pcl_filenames_with_errors{end+1} = pcl_filenames{i};
        %end
    end
    save([root_folder 'ptool_generation_data.mat']);
end



